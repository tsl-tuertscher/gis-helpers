import {
  getBearing,
  getBearing360,
  getDistance,
  getRadialCoordinates,
  getPointInPolygon,
  getBoundingRectangle,
  getRectangleIntersection,
  getPointInTriangle,
  getPointInBoundingRectangle,
  simplify,
} from './main';
import { round } from './core';

describe('main', () => {
  it('getDistance', () => {
    const res = Math.round(getDistance([9, 47.5], [13, 49.2]));
    expect(res).toBe(351187);
  });

  it('getBearing', () => {
    const res = Math.round(getBearing([9, 47.5], [13, 49.2]));
    expect(res).toBe(56);
  });

  it('getBearing360', () => {
    let res = getBearing360(578);
    expect(res).toBe(218);

    res = getBearing360(-490);
    expect(res).toBe(230);

    res = getBearing360(-49);
    expect(res).toBe(311);
  });

  it('getRadialCoordinates', () => {
    const res = getRadialCoordinates([9, 47.5], 45, 1000);
    expect(res[0]).toBe(9.009403);
    expect(res[1]).toBe(47.506352);
  });

  it('getPointInPolygon', () => {
    expect(
      getPointInPolygon(
        [
          [8.313217163085938, 46.71067759419637],
          [8.556976318359373, 46.71067759419637],
          [8.556976318359373, 46.82966386051541],
          [8.313217163085938, 46.82966386051541],
          [8.313217163085938, 46.71067759419637],
        ],
        [8.459472656249998, 46.779373682055635],
      ),
    ).toEqual(true);
  });

  it('boundingRectangle', () => {
    const res = getBoundingRectangle([
      [8.61328125, 46.98962081759436],
      [8.8604736328125, 47.07386310181414],
      [8.9154052734375, 46.897739085507],
      [8.84124755859375, 46.70596917928676],
      [8.63525390625, 46.84140712700584],
      [8.42376708984375, 47.00273390667881],
      [8.8055419921875, 47.10939214403789],
      [8.8055419921875, 46.822616668804926],
      [8.70941162109375, 46.781254534638606],
    ]);
    expect(res[0]).toEqual([8.42376708984375, 46.70596917928676]);
    expect(res[1]).toEqual([8.9154052734375, 47.10939214403789]);
  });

  it('getRectangleIntersection', () => {
    const res = getRectangleIntersection(
      [
        [9, 47],
        [9.5, 47.5],
      ],
      [
        [9.3, 47.3],
        [9.8, 47.8],
      ],
    );
    expect(res).toBe(true);
  });

  it('getPointInTriangle', () => {
    const triangle = [
      [9.92889404296875, 47.32998100273299],
      [9.911727905273438, 47.371152062709044],
      [9.8602294921875, 47.337426736595404],
    ];

    let res = getPointInTriangle(triangle, [9.946746826171875, 47.34603455771723]);
    expect(res).toBe(false);

    res = getPointInTriangle(triangle, [9.903144836425781, 47.33952066009526]);
    expect(res).toBe(true);
  });

  it('getPointInBoundingRectangle', () => {
    const triangle = [
      [9.92889404296875, 47.32998100273299],
      [9.911727905273438, 47.371152062709044],
      [9.8602294921875, 47.337426736595404],
    ];

    const boundingRectangle = getBoundingRectangle(triangle);

    let res = getPointInBoundingRectangle(boundingRectangle, [9.946746826171875, 47.34603455771723]);
    expect(res).toBe(false);

    res = getPointInBoundingRectangle(boundingRectangle, [9.903144836425781, 47.33952066009526]);
    expect(res).toBe(true);
  });

  it('simplify', () => {
    const linestring = [
      [16.44842303000007, 47.71961288700004],
      [16.448566192000044, 47.71971360400005],
      [16.44856855100005, 47.71971377800003],
      [16.44859754500004, 47.71971592500006],
      [16.44882073900004, 47.719732435000026],
      [16.448997210000073, 47.71974548500003],
      [16.449077113000044, 47.71975139300008],
      [16.449172040000064, 47.719758383000055],
      [16.449404379000043, 47.71977549400003],
      [16.44945410200006, 47.71977915700006],
      [16.449502395000025, 47.719775060000075],
      [16.449561017000065, 47.719770090000054],
      [16.44959453000007, 47.71976724800004],
      [16.44961081400004, 47.719765865000056],
      [16.449635201000035, 47.71976381600007],
      [16.449670421000064, 47.71976084700003],
      [16.449726100000078, 47.719756163000056],
      [16.449744672000065, 47.719754601000034],
      [16.449747471000023, 47.71975436400004],
      [16.44979140600003, 47.71975069400003],
      [16.449794738000037, 47.71975041200005],
      [16.449796110000023, 47.71975030300007],
      [16.449828092000075, 47.719747607000045],
      [16.44983443500007, 47.71974706100008],
      [16.449847335000072, 47.71974595000006],
      [16.449852452000073, 47.71974552200004],
      [16.449860487000024, 47.71974484900005],
      [16.44987308000003, 47.71974378300007],
      [16.44988697900004, 47.719742618000055],
      [16.449896387000024, 47.719741826000075],
      [16.44989826400007, 47.71974087900003],
      [16.449918540000056, 47.71973069500007],
      [16.449920750000047, 47.71972957700007],
      [16.44993383700006, 47.719722998000066],
      [16.449945513000046, 47.71971713100004],
      [16.449988234000045, 47.71969561800006],
      [16.45003421800004, 47.71967247300006],
      [16.450080188000072, 47.71964932000003],
      [16.45011754500007, 47.71963051100005],
      [16.45016619100005, 47.71960601400008],
      [16.450201125000035, 47.719588431000034],
      [16.45022405000003, 47.71957688500004],
      [16.45026259100007, 47.71955746300006],
      [16.45043743100007, 47.71946937300004],
      [16.450454432000072, 47.71946081100003],
      [16.450499792000073, 47.71943796800008],
      [16.450500801000032, 47.71943745900006],
      [16.45054811600005, 47.719413630000076],
      [16.450590771000066, 47.71939214400004],
      [16.450621134000073, 47.71937685300003],
      [16.45068492000007, 47.71934472800007],
      [16.45074580000005, 47.71931407500006],
      [16.45083349300006, 47.71926992200008],
      [16.450871626000037, 47.71925292800006],
      [16.450935883000056, 47.71922430500007],
      [16.451202308000063, 47.71910557500007],
      [16.451471396000045, 47.71898558200007],
      [16.451494550000064, 47.71897525900005],
      [16.451567271000044, 47.71894283000006],
      [16.451596539000036, 47.71892977700003],
      [16.45164173300003, 47.71890962400005],
      [16.451729165000074, 47.718870637000066],
      [16.451846385000067, 47.71881835700003],
      [16.451862176000077, 47.71881131600003],
      [16.45199465500002, 47.71875235500005],
      [16.452240838000023, 47.71864245800003],
      [16.45248409100003, 47.71853400200007],
      [16.452725745000066, 47.71842626700004],
      [16.452767703000063, 47.71840756200004],
      [16.45290133000003, 47.71834798700007],
      [16.452967399000045, 47.71831853200007],
      [16.453002681000044, 47.71830284500004],
      [16.453219773000058, 47.718236328000046],
      [16.453244678000033, 47.718228701000044],
      [16.453458839000064, 47.71816313200003],
      [16.453691778000064, 47.718091740000034],
      [16.453818570000067, 47.71805302000007],
      [16.453915777000077, 47.71801613000008],
      [16.454034145000037, 47.71797120600007],
      [16.454129900000055, 47.717934865000075],
      [16.454169448000073, 47.71791980200004],
      [16.454233432000024, 47.71789405900006],
      [16.454308194000077, 47.71786398000006],
      [16.45434227100003, 47.71784595500003],
      [16.454377546000046, 47.71782739000008],
      [16.45451831200006, 47.71772407600008],
      [16.454621506000024, 47.71764829500006],
      [16.45463925200005, 47.71763526400008],
      [16.454691940000032, 47.71759680300005],
      [16.454780284000037, 47.71753231000008],
      [16.454869161000033, 47.71746754700007],
      [16.454958437000073, 47.71740251300008],
      [16.45507458800006, 47.717317663000074],
      [16.455139382000027, 47.71727046400008],
      [16.45523145100003, 47.71720326900004],
      [16.45523675900006, 47.71719939500008],
      [16.45525021000003, 47.717189577000056],
      [16.455389291000074, 47.717051457000025],
      [16.45548831700006, 47.716953154000066],
      [16.45549877600007, 47.71694277200004],
      [16.455549379000047, 47.71689253800008],
      [16.455641575000072, 47.71680100400005],
      [16.455710529000044, 47.71673253800003],
      [16.45582889700006, 47.71661909900007],
      [16.455876080000053, 47.716573882000034],
      [16.455896143000075, 47.71654822700003],
      [16.455981913000073, 47.716441460000055],
      [16.45599181800003, 47.71642913100004],
      [16.456031433000078, 47.71638681600007],
      [16.45608580000004, 47.71632857900005],
      [16.456206509000026, 47.71619927800003],
      [16.456397137000067, 47.71599553300007],
      [16.45642642300004, 47.715964205000034],
      [16.456527184000038, 47.71585641300004],
      [16.45656672100006, 47.71581411600005],
      [16.456601057000057, 47.715777383000045],
      [16.456621303000077, 47.71575570200008],
      [16.456692781000072, 47.71567915700007],
      [16.45678915700006, 47.71554953200007],
      [16.45679879100004, 47.715536575000044],
      [16.456832666000025, 47.71549102700004],
      [16.456838065000056, 47.715477297000064],
      [16.456915602000038, 47.715280101000076],
      [16.456931155000063, 47.71524054200006],
      [16.45696618900007, 47.71515144300008],
      [16.457058174000053, 47.71490386600004],
      [16.457062760000042, 47.71489152400005],
      [16.457045107000056, 47.71488306200007],
      [16.45711633800005, 47.714762059000066],
      [16.45711933700005, 47.71475696300007],
      [16.45715632100007, 47.71469413500006],
      [16.457163856000022, 47.71468133500008],
      [16.457188838000036, 47.71463889800003],
      [16.457294397000055, 47.71445362500003],
      [16.45743647200004, 47.71412029100003],
      [16.45768380000004, 47.713670861000026],
      [16.45772174800004, 47.713552367000034],
      [16.457734595000034, 47.713519173000066],
      [16.45655749200006, 47.714158731000055],
      [16.455657339000027, 47.714647623000076],
      [16.455367210000077, 47.71480531600008],
      [16.453996535000044, 47.71554064600008],
      [16.45323977000004, 47.71596348300005],
      [16.452363559000048, 47.716452512000046],
      [16.45205308000004, 47.716625445000034],
      [16.451680530000033, 47.71683214400008],
      [16.451025661000074, 47.71720375500007],
      [16.450528507000058, 47.717471370000055],
      [16.449995065000053, 47.717760301000055],
      [16.44902606100004, 47.71828702300007],
      [16.448767240000052, 47.71842704800008],
      [16.447621972000036, 47.71904932000007],
      [16.44829743200006, 47.71952452600004],
      [16.44842303000007, 47.71961288700004],
    ];

    const simplified = simplify(linestring, 10, 5);
    expect(simplified).toEqual([
      [16.44842303000007, 47.71961288700004],
      [16.44987308000003, 47.71974378300007],
      [16.453915777000077, 47.71801613000008],
      [16.455549379000047, 47.71689253800008],
      [16.456931155000063, 47.71524054200006],
      [16.457734595000034, 47.713519173000066],
      [16.447621972000036, 47.71904932000007],
      [16.44842303000007, 47.71961288700004],
    ]);
  });
});
